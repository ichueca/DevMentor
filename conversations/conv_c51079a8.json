{
  "id": "conv_c51079a8",
  "name": "Habilitar textos bilingües en Spring",
  "created_at": "2026-01-09T09:39:51.230154",
  "updated_at": "2026-01-09T09:39:51.230165",
  "messages": [
    {
      "role": "user",
      "message": "Quiero saber cómo cambio mi aplicación Spring para que admita textos en inglés y castellano"
    },
    {
      "role": "assistant",
      "message": "## 1. ¿Qué es la “localización” (i18n) en Spring?\n\nSpring ya trae un mecanismo completo para **traducir** mensajes en tu aplicación:\n\n* **MessageSource** – un `ResourceBundleMessageSource` que lee archivos `messages_*.properties`.\n* **LocaleResolver** – determina el `Locale` (idioma/país) que debe usar cada petición.\n* **LocaleChangeInterceptor** – cambia el idioma cuando el cliente envía un parámetro (por ejemplo, `?lang=es`).\n\nCon esto puedes tener la misma aplicación “identical” pero con textos en **inglés** y **castellano**.\n\n---\n\n## 2. Estructura de los archivos de mensajes\n\nCrea una carpeta `src/main/resources` (ya debe existir). Dentro, añade los archivos:\n\n| Archivo | Descripción | Ejemplo de contenido |\n|---------|-------------|----------------------|\n| `messages.properties` | Mensajes por defecto (usa cuando no haya `messages_es` ni `messages_en`) | `greeting=Hello, World!` |\n| `messages_en.properties` | Inglés | `greeting=Hello, World!` |\n| `messages_es.properties` | Castellano | `greeting=¡Hola, Mundo!` |\n\n> **Tip:** Si solo necesitas los dos idiomas, no es obligatorio el `messages.properties`; Spring usará el que exista (el primero que encuentre).\n\n---\n\n## 3. Configuración en Spring Boot\n\n### 3.1. Spring Boot hace la mayoría de la configuración automáticamente\n\nSolo tienes que:\n\n```yaml\n# src/main/resources/application.yml\nspring:\n  messages:\n    basename: messages          # nombre base de los archivos\n    fallback-to-system-locale: false\n```\n\n> `fallback-to-system-locale: false` evita que Spring use el idioma del sistema cuando no encuentra la clave.\n\n### 3.2. Añadir `LocaleResolver` y `LocaleChangeInterceptor`\n\n```java\n// src/main/java/com/ejemplo/config/WebConfig.java\npackage com.ejemplo.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.LocaleResolver;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\nimport org.springframework.web.servlet.i18n.*;\n\n@Configuration\npublic class WebConfig implements WebMvcConfigurer {\n\n    /** Determina el idioma que se usará en cada petición */\n    @Bean\n    public LocaleResolver localeResolver() {\n        // Puedes usar SessionLocaleResolver (mantiene el idioma en la sesión)\n        SessionLocaleResolver slr = new SessionLocaleResolver();\n        slr.setDefaultLocale(Locale.ENGLISH); // idioma por defecto\n        return slr;\n    }\n\n    /** Detecta el parámetro \"lang\" en la URL y cambia el idioma */\n    @Bean\n    public LocaleChangeInterceptor localeChangeInterceptor() {\n        LocaleChangeInterceptor lci = new LocaleChangeInterceptor();\n        lci.setParamName(\"lang\"); // ?lang=es\n        return lci;\n    }\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(localeChangeInterceptor());\n    }\n}\n```\n\n> *Si prefieres que el idioma dependa del encabezado `Accept-Language` (p.ej. del navegador), usa `AcceptHeaderLocaleResolver` en vez de `SessionLocaleResolver`.*\n\n---\n\n## 4. Uso en vistas (Thymeleaf)\n\nEn tu archivo HTML/Thymeleaf:\n\n```html\n<!DOCTYPE html>\n<html xmlns:th=\"http://www.thymeleaf.org\">\n<head>\n    <meta charset=\"UTF-8\"/>\n    <title th:text=\"#{title}\">My App</title>\n</head>\n<body>\n    <h1 th:text=\"#{greeting}\">Hello</h1>\n\n    <!-- Botones para cambiar idioma -->\n    <a th:href=\"@{${#request.requestURL}(lang='en')}\">English</a> |\n    <a th:href=\"@{${#request.requestURL}(lang='es')}\">Español</a>\n</body>\n</html>\n```\n\nThymeleaf buscará en el `MessageSource` la clave `greeting` y mostrará el texto correspondiente al `Locale` actual.\n\n---\n\n## 5. Uso en controladores y servicios\n\n```java\nimport org.springframework.context.MessageSource;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.ui.Model;\nimport org.springframework.web.bind.annotation.GetMapping;\n\nimport java.util.Locale;\n\n@Controller\npublic class WelcomeController {\n\n    private final MessageSource messageSource;\n\n    public WelcomeController(MessageSource messageSource) {\n        this.messageSource = messageSource;\n    }\n\n    @GetMapping(\"/\")\n    public String index(Model model, Locale locale) {\n        String welcome = messageSource.getMessage(\"greeting\", null, locale);\n        model.addAttribute(\"welcome\", welcome);\n        return \"index\";\n    }\n}\n```\n\n`Locale` se inyecta automáticamente por Spring con el valor que haya determinado el `LocaleResolver`.\n\n---\n\n## 6. En APIs REST (JSON)\n\nPara devolver mensajes traducidos en un endpoint REST:\n\n```java\n@GetMapping(\"/api/hello\")\npublic Map<String, String> hello(Locale locale) {\n    String greeting = messageSource.getMessage(\"greeting\", null, locale);\n    return Map.of(\"message\", greeting);\n}\n```\n\nPuedes añadir el parámetro `lang` al query string (`/api/hello?lang=es`) y el interceptor cambiará el idioma antes de que llegue al controlador.\n\n---\n\n## 7. Más allá de los archivos `.properties`\n\n| Necesidad | Solución |\n|-----------|----------|\n| **Mensajes dinámicos** (por ejemplo, errores de validación) | Usa `@MessageSource` y `ErrorCodes` o la validación `@Validated` con `javax.validation.constraints` y `MessageSource` integrado. |\n| **Traducción de contenido de la base de datos** | Crea tablas con una columna `lang` y otra `content`. Al leer, filtra por `lang = currentLocale.getLanguage()`. |\n| **Cacheo de mensajes** | `ReloadableResourceBundleMessageSource` permite recargar archivos sin reiniciar la app (útil en desarrollo). |\n| **Frameworks UI** | Si usas **Spring MVC** con JSP, usa `<spring:message code=\"greeting\"/>`. Si usas **Thymeleaf**, usa `#{greeting}`. Si usas **Angular/React**, sigue una arquitectura SPA y consume la API REST; la traducción se hace en el cliente. |\n\n---\n\n## 8. Checklist rápido\n\n1. **Crear archivos `messages_*.properties`** con las claves y textos.\n2. **Configurar `basename`** en `application.yml` (o `application.properties`).\n3. **Definir `LocaleResolver` + `LocaleChangeInterceptor`** (ej. `lang` param).\n4. **Usar claves (`#{clave}`) en vistas** o `messageSource.getMessage(...)` en código.\n5. **Cambiar idioma** con `?lang=es` o cambiando el encabezado `Accept-Language`.\n\n¡Y eso es todo! Con estos pasos tu aplicación Spring ya podrá mostrar textos tanto en inglés como en castellano, cambiando el idioma según la petición del usuario. Si necesitas alguna ayuda adicional (por ejemplo, con un escenario concreto de tu proyecto), no dudes en preguntar."
    }
  ]
}